copyright: Copyright Â© 2020 Breakside Inc.
kind: protocol
introduced: 2021.10.0
summary: Protocol for database-storable objects
description: |
  Defines an interface your classes can adopt for database saving and loading
topics:
  - name: Unique Identification
    members:
      - name: id
        kind: property
        type: String
        summary: A unique identifier for the object conforming to `DBID()` standards
        description: |
          Every object stored in a database must have an `id` property that
          conforms to the format generated by `DBID()`.
  - name: Dictionary Representation
    members:
      - name: initFromStorableDictionary
        kind: init
        type: dictionary
        summary: Encode the properties of your object into a plain dictionary
          that can be stored in an object database
        arguments:
          - name: dictionary
            type: dictionary
            summary: The dictionary to write plain properties to
        description: |
          Allows your class to decide which properties need to be stored,
          and which formats to use for non-storable types like `JSData`,
          `JSDate`, or references to custom classes.

          ````
          // #import DBKit
          "use strict";

          JSClass("Message", JSSObject, {

            id: null,
            data: null,
            sender: null,
            created: null,

            initWithData: function(data, sender){
              this.id = DBID("message");
              this.data = data;
              this.sender = sender;
              this.created = JSDate.now;
            },

            initFromStorableDictionary: async function(dictionary, graph){
              this.data = dictionary.data.dataByDecodingBase64();
              this.created = JSDate.initWithTimeIntervalSince1970(dictionary.created);
              this.sender = await graph.object(dictionary.sender);
            },

            encodeToStorableDictionary: function(dictionary){
              dictionary.data = this.data.base64StringRepresentation();
              dictionary.created = this.created.timeIntervalSince1970;
              dictionary.sender = this.sender.id;
            }

          });
          ````
      - name: encodeToStorableDictionary
        type: dictionary
        summary: Encode the properties of your object into a plain dictionary
          that can be stored in an object database
        arguments:
          - name: dictionary
            type: dictionary
            summary: The dictionary to write plain properties to
        description: |
          Allows your class to decide which properties need to be stored,
          and which formats to use for non-storable types like `JSData`,
          `JSDate`, or references to custom classes.

          ````
          // #import DBKit
          "use strict";

          JSClass("Message", JSSObject, {

            id: null,
            data: null,
            sender: null,
            created: null,

            initWithData: function(data, sender){
              this.id = DBID("message");
              this.data = data;
              this.sender = sender;
              this.created = JSDate.now;
            },

            initFromStorableDictionary: async function(dictionary, graph){
              this.data = dictionary.data.dataByDecodingBase64();
              this.created = JSDate.initWithTimeIntervalSince1970(dictionary.created);
              this.sender = await graph.object(dictionary.sender);
            },

            encodeToStorableDictionary: function(dictionary){
              dictionary.data = this.data.base64StringRepresentation();
              dictionary.created = this.created.timeIntervalSince1970;
              dictionary.sender = this.sender.id;
            }

          });
          ````